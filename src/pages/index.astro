---
import '../styles/index.css';
import '../styles/article.css';


import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import { name, openGraph } from 'spectre:globals';
import Card from '../components/Card.astro';
import Icon from '../components/Icon.astro';
import Layout from '../layouts/Layout.astro';
import ImageGlow from '../components/ImageGlow.astro';

const [socials, workExperience, education, projects] =
    await Promise.all([
        getCollection("socials"),
        getCollection("workExperience"),
        getCollection("education"),
        getCollection("projects", (project) => project.data.draft !== true)
    ]);

const slugify = (string: string): string => {
    return string
        .toLowerCase()
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-|-$/g, '');
};
---

<Layout
    title={openGraph.home.title || name}
    description={openGraph.home.description}
>
    <div class="center-container" slot="center">
        <div class="section-container">
            <h1>Hi there! I'm<br><span class="text-glow">Kim Pham</span></h1>
            <p style="font-size: 1.25em; margin-bottom: 2rem;">
                I'm a <span class="text-glow">frontend software engineer</span> from Melbourne, Australia.<br/>
                I love building delightful user experiences with design and code.
            </p>
            <div class="socials-list" style="">
                {
                    socials.map((item) => (
                        <a href={item.data.link} style="text-decoration: none;">
                            <div class="socials-link">
                                <Icon
                                    type={item.data.icon.type}
                                    name={item.data.icon.name as any}
                                    width={24}
                                    height={24}
                                    class="glow-icon"
                                />
                                <span>{item.data.text}</span>
                            </div>
                        </a>
                    ))
                }
            </div>
        </div>
        <div class="section-container">
                <div class="header-container">
                    <Icon
                        type="lucide"
                        name="briefcase-business"
                        width={24}
                        height={24}
                        class="glow-icon"
                    />
                    <h2>Work Experience</h2>
                    <a href={`/work`}>See more </a>
                </div>
            <Card class="hover-effect">
                {
                    workExperience.reverse().map((entry) => (
                    <a href={'/work'} style="text-decoration: none; color: inherit;">
                        <div class="card-entry">
                            <div class="card-header">
                                <Image
                                    quality={100}
                                    width={80}
                                    height={80}
                                    src={entry.data.image}
                                    alt={`${entry.data.company} logo`}
                                    loading="eager"
                                />
                                <div>
                                    <span class="card-date">
                                        {entry.data.duration}
                                    </span>
                                    <h3 class="card-title">
                                        {entry.data.company}
                                    </h3>
                                    <span class="card-subtitle">
                                        {entry.data.title}
                                    </span>
                                </div>
                            </div>
                            <p>
                                {entry.data.description}
                            </p>
                        </div>
                    </a>
                    ))
                }
            </Card>
        </div>
        <div class="section-container">
            <div class="header-container">
                <Icon
                    type="lucide"
                    name="sparkles"
                    width={24}
                    height={24}
                    class="glow-icon"
                />
                <h2>Projects</h2>
                <a href={`/projects`}>See all</a>
            </div>
            {
                projects.reverse().map((entry) => (
                    <Card class="hover-effect" style="margin-bottom: 1rem;" onclick=`location.href='/projects/${slugify(entry.data.title)}';`>
                        <div class="card-entry">
                            <div class="project-header">
                                <div class="project-container" style="flex: 3">
                                    <ImageGlow quality={100} class="article-image" src={entry.data.image} alt={entry.data.title} />
                                </div>
                                <div class="project-container" style="flex: 2">
                                    <h3 class="card-title">
                                        {entry.data.title}
                                    </h3>
                                    <span class="card-date">
                                        {entry.data.technology}
                                    </span>
                                    <p>
                                        {entry.data.description}
                                    </p>
                                    <div class="socials-link-list">
                                        <a href={`projects/${slugify(entry.data.title)}`} style="text-decoration: none;">
                                            <div class="socials-link" style="background:var(--dark-purple)">
                                                <Icon
                                                    type={'lucide'}
                                                    name={'eye' as any}
                                                    width={24}
                                                    height={24}
                                                    class="glow-icon"
                                                />
                                                <span>Read more</span>
                                            </div>
                                        </a>
                                        <a href={entry.data.demoLink} style="text-decoration: none;">
                                            <div class="socials-link" style="background:var(--dark-purple)">
                                                <Icon
                                                    type={'lucide'}
                                                    name={'play' as any}
                                                    width={24}
                                                    height={24}
                                                    class="glow-icon"
                                                />
                                                <span>Live demo</span>
                                            </div>
                                        </a>
                                        <a href={entry.data.githubLink} style="text-decoration: none;">
                                            <div class="socials-link" style="background:var(--dark-purple)">
                                                <Icon
                                                    type={'lucide'}
                                                    name={'github' as any}
                                                    width={24}
                                                    height={24}
                                                    class="glow-icon"
                                                />
                                                <span>View code</span>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </Card>
                ))
            }
        </div>
        <div class="section-container">
            <div class="header-container">
                <Icon
                    type="lucide"
                    name="graduation-cap"
                    width={24}
                    height={24}
                    class="glow-icon"
                />
                <h2>Education</h2>
            </div>
            <div class="education-cards">
                {
                    education.reverse().map((entry) => (
                        <Card class="education-card" tabindex="0">
                            <div class="card-entry">
                                <div class="education-header">
                                    <Image
                                        quality={100}
                                        width={150}
                                        height={150}
                                        src={entry.data.image}
                                        alt={entry.data.title}
                                        loading="eager"
                                    />
                                    <div>
                                        <span class="card-date">
                                            {entry.data.duration}
                                        </span>
                                        <h3 class="card-title">
                                            {entry.data.title}
                                        </h3>
                                        <span class="card-subtitle">
                                            {entry.data.company === 'Monash University' ? entry.data.company : ''}
                                        </span>
                                    </div>
                                </div>
                                <div set:html={entry.data.description} class="education-desc"/>
                            </div>
                        </Card>
                    ))
                }
            </div>
        </div>
    </div>
</Layout>
<style>
    .center-container {
        display: flex;
        flex-direction: column;
    }

    .center-container h1 {
        font-size: 1.5em;
    }

    h1 .text-glow {
        font-size: 3rem;
    }

    .socials-list {
        display: flex;
        flex-direction: row;
        gap: 1rem;
    }

    .socials-link {
        padding: 0.5rem 1.5rem;
        border-radius: 1rem;
        border: 1px solid var(--dark-grey);
        background: var(--darkest-purple);
        text-decoration: none;
    }

    .socials-link,
    .hover-effect {
        transition:
            background-color 0.15s ease,
            border 0.15s ease;
    }

    .socials-link:hover,
    .socials-link:focus-visible {
        background-color: #1f2434;
        border: 1px solid var(--primary);
    }

    .hover-effect:hover,
    .hover-effect:focus-visible {
        background-color: #181a28;
        border: 1px solid var(--primary);
    }

    .socials-link:focus-visible {
        outline: none;
    }

    .header-container {
        align-items: baseline;
        justify-items: center;
    }

    .section-container {
         margin-bottom: 3rem;
    }

    .education-header {
        align-items: center;
        justify-items: center;
        text-align: center;
        gap: 1rem;
    }

    .education-cards {
        display: flex;
        flex-direction: row;
        gap: 1rem;
    }

    .education-card {
        min-height: 510px;
        align-content: center;
    }

    .education-card {
        background-color: var(--darker-purple);
    }

    .education-desc {
        display: none;
    }

    .education-card.show-desc .education-desc {
      display: block;
    }

    .education-card.show-desc .education-header {
        display: none;
    }

    .card-entry {
        display: block;
        width:100%;
    }

    .project-header {
        width: 100%;
        display: flex;
        flex-direction: row;
        gap: 2rem;
        align-items: center;
    }

    .card-links {
        display: flex;
        flex-direction: column;
        margin-top: 0.5rem;
        gap: 0.5rem;
    }

    .socials-link-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
    }

    @media screen and (max-width: 1024px) {
        .project-header {
            flex-direction: column;
        }

        .project-header {
            gap: 1rem;
        }
    }

    @media screen and (max-width: 640px) {
        .center-container {
            margin: 0 1rem;
            gap: 1rem;
        }

        .socials-list,
        .education-cards {
            flex-direction: column;
        }

        .education-card {
            min-height: 325px;
        }

        .socials-link {
            justify-content: center;
        }
    }
  
    @media (hover: hover) {
        .education-card:hover .education-desc {
            display: block;
        }
    
        .education-card:hover .education-header {
            display: none;
        }
    }
</style>
<script>
    document
        .querySelectorAll<HTMLDivElement>(".education-card")
        .forEach((card) => {
            card.addEventListener("click", () => {
            card.classList.toggle("show-desc");
            });
        });
    document
        .querySelectorAll<HTMLDivElement>(".education-card")
        .forEach((card) => {
            card.addEventListener("focus", () => {
            card.classList.add("show-desc");
            });
        });
    document
        .querySelectorAll<HTMLDivElement>(".education-card")
        .forEach((card) => {
            card.addEventListener("blur", () => {
            card.classList.remove("show-desc");
            });
        });
</script>
